#!/bin/bash

# Caminho das páginas
PAGES_DIR="./src/app"

# Comando que será inserido
DYNAMIC_LINE="export const dynamic = 'force-static';"
USE_CLIENT_LINE='"use client";'

# Percorre todos os arquivos .tsx dentro de /app
find "$PAGES_DIR" -type f -name "*.tsx" | while read FILE
do
  # Verifica se a linha já existe no arquivo
  if grep -Fxq "$DYNAMIC_LINE" "$FILE"; then
    echo "⚠️ Já existe em: $FILE"
    continue
  fi

  # Se o arquivo contém "use client", adiciona logo abaixo dele
  if grep -Fxq "$USE_CLIENT_LINE" "$FILE"; then
    # Adiciona a linha logo abaixo de "use client"
    awk -v line="$DYNAMIC_LINE" '
      /"use client";/ { print; print line; next }
      { print }
    ' "$FILE" > temp && mv temp "$FILE"
  else
    # Caso contrário, adiciona no topo do arquivo
    echo -e "$DYNAMIC_LINE\n$(cat "$FILE")" > "$FILE"
  fi

  echo "✅ Adicionado em: $FILE"
done
